<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA STORE | Premium Codes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; padding-bottom: 80px; }
        .glass-effect { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .dark .glass-effect { background: rgba(15, 23, 42, 0.85); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .product-card { transition: all 0.3s; border-radius: 24px; background: white; border: 1px solid rgba(0,0,0,0.05); }
        .dark .product-card { background: #1e293b; border-color: rgba(255,255,255,0.05); }
        .drawer-closed { transform: translateX(100%); } .drawer-open { transform: translateX(0); }
    </style>
</head>
<body class="bg-slate-50 dark:bg-[#0b1121] text-slate-800 dark:text-slate-200">

    <nav class="glass-effect sticky top-0 z-50 w-full h-16 sm:h-20 flex items-center">
        <div class="max-w-7xl mx-auto px-4 w-full flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg text-white">
                    <i class="fa-solid fa-bolt text-xl"></i>
                </div>
                <span class="font-black text-2xl tracking-tighter dark:text-white">AURA<span class="text-blue-600">STORE</span></span>
            </div>
            <div id="authSection" class="flex items-center gap-3">
                </div>
        </div>
    </nav>

    <div class="pt-12 pb-12 text-center px-4">
        <h1 class="text-4xl sm:text-6xl font-black mb-4 dark:text-white">Elite Source Codes</h1>
        <p class="text-slate-500 dark:text-slate-400 font-medium">Automatic delivery to your vault.</p>
    </div>

    <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="product-list">
        <p class="col-span-full text-center py-20 font-bold text-slate-400">Loading products...</p>
    </div>

    <div class="md:hidden fixed bottom-0 left-0 w-full bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 h-16 flex justify-around items-center z-40" id="mobileBottomNav">
        </div>

    <script>
        let currentUser = null;
        try { 
            const stored = localStorage.getItem('user');
            if(stored) currentUser = JSON.parse(stored);
        } catch(e) { console.log("User parse error"); }

        async function init() {
            if(currentUser && currentUser.id) {
                try {
                    const res = await fetch('/api/user/' + currentUser.id);
                    const data = await res.json();
                    if(data.success) {
                        currentUser = {...currentUser, ...data};
                        localStorage.setItem('user', JSON.stringify(currentUser));
                    } else if(data.banned) {
                        localStorage.removeItem('user');
                        location.href = '/login';
                    }
                } catch(e) {}
            }
            renderAuth();
            loadProducts();
        }

        function renderAuth() {
            const authDiv = document.getElementById('authSection');
            const mobNav = document.getElementById('mobileBottomNav');
            
            if(currentUser) {
                authDiv.innerHTML = `
                    <div class="hidden sm:flex items-center bg-slate-100 dark:bg-slate-800 px-4 py-2 rounded-full font-bold">
                        <span class="mr-2 border-r pr-2 text-sm">${currentUser.name}</span>
                        <span class="text-blue-600">$${currentUser.balanceUsd.toFixed(2)}</span>
                    </div>
                    <button onclick="location.href='/login'" class="w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center"><i class="fa-solid fa-user"></i></button>
                `;
                mobNav.innerHTML = `
                    <button onclick="location.reload()" class="flex flex-col items-center text-blue-600"><i class="fa-solid fa-house"></i><span class="text-[10px]">Home</span></button>
                    <button onclick="Swal.fire('Vault coming soon')" class="flex flex-col items-center text-slate-400"><i class="fa-solid fa-box"></i><span class="text-[10px]">Vault</span></button>
                    <button onclick="location.href='/login'" class="flex flex-col items-center text-slate-400"><i class="fa-solid fa-user"></i><span class="text-[10px]">Profile</span></button>
                `;
            } else {
                authDiv.innerHTML = `<button onclick="location.href='/login'" class="bg-blue-600 text-white px-6 py-2 rounded-full font-bold">Login</button>`;
                mobNav.innerHTML = `<button onclick="location.href='/login'" class="w-[90%] bg-blue-600 text-white py-3 rounded-xl font-bold">Access Store</button>`;
            }
        }

        async function loadProducts() {
            const res = await fetch('/api/products');
            const products = await res.json();
            const list = document.getElementById('product-list');
            list.innerHTML = '';
            products.forEach(p => {
                list.innerHTML += `
                    <div class="product-card p-6 shadow-sm">
                        <div class="w-full h-40 bg-slate-100 dark:bg-slate-800 rounded-xl mb-4 flex items-center justify-center">
                            ${p.imageId ? `<img src="/api/photo/${p.imageId}" class="w-full h-full object-cover rounded-xl">` : `<i class="fa-solid fa-code text-4xl text-slate-300"></i>`}
                        </div>
                        <h3 class="font-black text-xl mb-1 dark:text-white">${p.name}</h3>
                        <p class="text-blue-600 font-black text-2xl mb-4">$${p.price}</p>
                        <button class="w-full bg-slate-900 dark:bg-slate-700 text-white py-3 rounded-xl font-bold hover:bg-blue-600 transition-colors">Add to Cart</button>
                    </div>
                `;
            });
        }

        init();
    </script>
</body>
</html>
