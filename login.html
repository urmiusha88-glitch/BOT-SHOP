<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access | AURA DIGITAL STORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #050b14; color: white; overflow: hidden; }
        .split-left { background: linear-gradient(45deg, #2563eb, #7c3aed); }
        .input-box { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; color: white; outline: none; }
        .input-box:focus { border-color: #3b82f6; box-shadow: 0 0 15px rgba(59,130,246,0.3); }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        .tab-inactive { color: #64748b; }
        @media (max-width: 1024px) { .split-left { height: 25vh; } .split-right { height: 75vh; border-radius: 40px 40px 0 0; margin-top: -40px; background: #0b1121; } }
    </style>
</head>
<body class="h-screen w-full flex flex-col lg:flex-row">

    <div class="split-left w-full lg:w-1/2 flex flex-col justify-center p-12 relative overflow-hidden">
        <div class="relative z-10 text-center lg:text-left">
            <h1 class="text-4xl lg:text-6xl font-black mb-2 tracking-tighter">AURA <span class="text-blue-200">DIGITAL</span></h1>
            <p class="text-blue-100 font-medium opacity-80">Premium Marketplace Access.</p>
        </div>
    </div>

    <div class="split-right w-full lg:w-1/2 flex justify-center items-start lg:items-center p-8 z-10 bg-[#0b1121] overflow-y-auto">
        <div class="w-full max-w-md mt-6 lg:mt-0">
            
            <div class="flex gap-6 mb-8 border-b border-slate-800">
                <button id="loginTab" onclick="switchTab('login')" class="pb-2 font-bold tab-active">Login</button>
                <button id="regTab" onclick="switchTab('reg')" class="pb-2 font-bold tab-inactive">Register</button>
            </div>

            <div id="loginSection" class="space-y-4">
                <h2 class="text-2xl font-bold mb-4">Welcome Back</h2>
                <input type="email" id="lEmail" placeholder="Email Address" class="input-box w-full p-4 rounded-xl font-bold">
                <input type="password" id="lPass" placeholder="Password" class="input-box w-full p-4 rounded-xl font-bold">
                
                <div class="flex justify-end">
                    <button onclick="switchTab('forgot')" class="text-sm font-bold text-blue-500 hover:underline">Forgot Password?</button>
                </div>

                <button onclick="handleLogin()" id="btnLogin" class="w-full bg-blue-600 py-4 rounded-xl font-black tracking-widest uppercase hover:bg-blue-500 transition-colors mt-2">Enter Vault</button>
            </div>

            <div id="regSection" class="hidden space-y-4">
                <h2 class="text-2xl font-bold mb-4">Create Account</h2>
                <input type="text" id="rName" placeholder="Full Name" class="input-box w-full p-4 rounded-xl font-bold">
                <input type="email" id="rEmail" placeholder="Real Email Address (For Verification)" class="input-box w-full p-4 rounded-xl font-bold">
                <input type="password" id="rPass" placeholder="Password" class="input-box w-full p-4 rounded-xl font-bold">
                <div class="grid grid-cols-2 gap-3">
                    <select id="rCountry" class="input-box p-4 rounded-xl font-bold text-slate-400">
                        <option value="BD">Bangladesh</option><option value="IN">India</option>
                    </select>
                    <input type="text" id="rRef" placeholder="Ref Code (Opt)" class="input-box p-4 rounded-xl font-bold uppercase text-emerald-400">
                </div>
                <button onclick="handleRegister()" id="btnReg" class="w-full bg-slate-100 text-slate-900 hover:bg-white py-4 rounded-xl font-black tracking-widest uppercase transition-colors mt-2">Sign Up</button>
            </div>

            <div id="forgotSection" class="hidden space-y-4">
                <h2 class="text-2xl font-bold mb-2">Reset Password</h2>
                <p class="text-sm text-slate-400 mb-4">Enter your email to receive a password reset link.</p>
                <input type="email" id="fEmail" placeholder="Your Account Email" class="input-box w-full p-4 rounded-xl font-bold">
                <button onclick="handleForgot()" id="btnForgot" class="w-full bg-blue-600 py-4 rounded-xl font-black tracking-widest uppercase hover:bg-blue-500 transition-colors mt-2">Send Reset Link</button>
                <div class="text-center mt-4">
                    <button onclick="switchTab('login')" class="text-sm font-bold text-slate-500 hover:text-white">Back to Login</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        const swalDark = { background: '#1e293b', color: '#fff' };

        function switchTab(t) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('regSection').classList.add('hidden');
            document.getElementById('forgotSection').classList.add('hidden');
            
            if(t === 'login') {
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('loginTab').className = 'pb-2 font-bold tab-active';
                document.getElementById('regTab').className = 'pb-2 font-bold tab-inactive';
            } else if(t === 'reg') {
                document.getElementById('regSection').classList.remove('hidden');
                document.getElementById('loginTab').className = 'pb-2 font-bold tab-inactive';
                document.getElementById('regTab').className = 'pb-2 font-bold tab-active';
            } else {
                document.getElementById('forgotSection').classList.remove('hidden');
                document.getElementById('loginTab').className = 'pb-2 font-bold tab-inactive';
                document.getElementById('regTab').className = 'pb-2 font-bold tab-inactive';
            }
        }

        async function handleLogin() {
            const email = document.getElementById('lEmail').value;
            const password = document.getElementById('lPass').value;
            if(!email || !password) return;
            const btn = document.getElementById('btnLogin'); btn.innerText = "Processing...";
            
            const res = await fetch('/api/login', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({email, password}) });
            const data = await res.json();
            btn.innerText = "Enter Vault";
            
            if(data.success) { localStorage.setItem('user', JSON.stringify(data.user)); location.href = '/'; }
            else Swal.fire({title: 'Error', text: data.error || 'Invalid credentials', icon: 'error', ...swalDark});
        }

        async function handleRegister() {
            const name = document.getElementById('rName').value;
            const email = document.getElementById('rEmail').value;
            const password = document.getElementById('rPass').value;
            const country = document.getElementById('rCountry').value;
            const refCode = document.getElementById('rRef').value;
            if(!name || !email || !password) return;
            
            const btn = document.getElementById('btnReg'); btn.innerText = "Creating...";
            const res = await fetch('/api/register', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({name, email, password, country, refCode}) });
            const data = await res.json();
            btn.innerText = "Sign Up";
            
            if(data.success) { 
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
                Swal.fire({title: 'Verification Sent!', text: data.message, icon: 'success', ...swalDark}); 
                switchTab('login'); 
            }
            else Swal.fire({title: 'Error', text: data.error || 'Registration failed', icon: 'error', ...swalDark});
        }

        async function handleForgot() {
            const email = document.getElementById('fEmail').value;
            if(!email) return;
            const btn = document.getElementById('btnForgot'); btn.innerText = "Sending...";
            
            const res = await fetch('/api/forgot-password', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({email}) });
            const data = await res.json();
            btn.innerText = "Send Reset Link";
            
            if(data.success) { Swal.fire({title: 'Email Sent!', text: 'Check your inbox for the reset link.', icon: 'success', ...swalDark}); switchTab('login'); }
            else Swal.fire({title: 'Error', text: data.error, icon: 'error', ...swalDark});
        }
    </script>
</body>
</html>
